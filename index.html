<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>路線搜尋器</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .suggestions {
            border: 1px solid #ddd;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        .suggestion-item {
            padding: 8px;
            cursor: pointer;
        }
        .suggestion-item:hover {
            background-color: #e0f7fa;
        }
    </style>
</head>
<body>
    <h2>選擇您的路線</h2>
    <input type="text" id="searchInput" placeholder="例如：韓亞、KE102、弘大">
    <div id="suggestions" class="suggestions" style="display: none;"></div>
    <button id="confirmButton">確認選擇</button>

    <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.js"></script>
    <script>
        let routes = [];

        // 動態讀取 JSON 檔案
        fetch('All_Route.json')
            .then(response => response.json())
            .then(data => {
                routes = data; // 將 JSON 資料存入 routes
                console.log("已成功載入路線資料");
            })
            .catch(error => {
                console.error("讀取 JSON 檔案時發生錯誤:", error);
                alert("無法讀取路線資料，請稍後再試。");
            });

        const fuseOptions = { keys: ["航班號碼", "航空公司", "下車處", "Route"] };
        const searchInput = document.getElementById("searchInput");
        const suggestions = document.getElementById("suggestions");

        searchInput.addEventListener("input", (event) => {
            const value = event.target.value.trim();
            if (value.length === 0) {
                suggestions.style.display = "none";
                return;
            }

            const fuse = new Fuse(routes, fuseOptions);
            const results = fuse.search(value).slice(0, 5); // 顯示最多 5 個結果
            suggestions.innerHTML = results.map(result => `
                <div class="suggestion-item" onclick="selectRoute('${result.item.Route}')">
                    ${result.item.航空公司} - ${result.item.航班號碼} - ${result.item.下車處} (${result.item.航班抵達/起飛時間})
                </div>
            `).join('');
            suggestions.style.display = "block";
        });

        function selectRoute(route) {
            searchInput.value = route;
            suggestions.style.display = "none";
        }

        document.getElementById("confirmButton").addEventListener("click", () => {
            const selectedRoute = searchInput.value.trim();
            if (!selectedRoute) {
                alert("請選擇或輸入正確的路線！");
                return;
            }
            alert(`已選擇路線：${selectedRoute}`);
        });
    </script>
</body>
</html>